@* @model IEnumerable<bkfc.Models.Order> *@

@{
    ViewData["Title"] = "Order status";
    ViewData["css"] = "profile.css";
    var cart = (List<Item>)ViewData["cart"];

}

<h1 style="text-align: center;">My Cart</h1>
@if(cart != null)
{
    @foreach(Item item in cart)
    {
        @if(item != null)
        {
            var foodId = item.food.Id;
            var foodPrice = item.food.Price;
            <div id=@item.food.Id class="container px-0 my-4 d-flex justify-content-between align-items-center border" style="height:90px">
                <img style="width: 120px; height: 100%; object-fit: cover;" src=@item.food.Image >
                <div class="text-left d-flex flex-column justify-content-around" style="width: 150px;height: 100%; margin-left:10px;">
                    <h5>@item.food.Name</h5>
                    <div class="d-flex justify-content-left">
                        <button class="btn btn-danger" style="width:35.5px !important;" type="button" name="button" onClick="decrease(@foodId,@foodPrice)">
                        -
                        </button>
                        <input type="number" min="1" style="width: 50px;" id="quantity" class="quantity" value=@item.quantity size="2" onchange="change(@foodId,@foodPrice)">
                        <button class="btn btn-primary" style="width:35.5px !important;" type="button" name="button" onClick="increase(@foodId,@foodPrice)">
                        +
                        </button>
                        
                    </div>
                </div>
                <div class="text-right d-flex flex-column justify-content-between align-items-right" style="height: 100%">
                    <button class="btn btn-link text-danger" style="width:46px !important; margin-left: auto;" onClick="remove(@foodId,@foodPrice)">
                        <svg class="bi bi-x-circle-fill" width="1.5em" height="1.5em" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-4.146-3.146a.5.5 0 0 0-.708-.708L8 7.293 4.854 4.146a.5.5 0 1 0-.708.708L7.293 8l-3.147 3.146a.5.5 0 0 0 .708.708L8 8.707l3.146 3.147a.5.5 0 0 0 .708-.708L8.707 8l3.147-3.146z"/>
                        </svg>
                    </button>
                    <div class="price-div">
                        @if(item.quantity >0)
                        {
                            var price = item.quantity*item.food.Price;
                            <i class="price"> @price </i>
                        }
                         VND
                    </div>
                    
                </div>
                
            </div>
        }
        
    }
    <h3 id="totalPrice" class="text-right"></h3>
    <button class="btn btn-primary btn-lg btn-block"> Payment </button>

}
@section Scripts{
    <script>
        updateTotalPrice();

        function increase(foodId,foodPrice)
        {
            $.post('@Url.Action("increase","Cart")',{foodId:foodId });
            
            var quantity = ++document.getElementById(foodId).getElementsByClassName("quantity")[0].value;
            document.getElementById(foodId).getElementsByClassName("price")[0].innerHTML = foodPrice*quantity;
            updateTotalPrice();
        }
        function decrease(foodId,foodPrice)
        {
            quantityElement = document.getElementById(foodId).getElementsByClassName("quantity")[0];
            if(quantityElement.value == 1) return remove(foodId);
            $.post('@Url.Action("decrease","Cart")',{foodId:foodId });
            var quantity = --quantityElement.value;
            document.getElementById(foodId).getElementsByClassName("price")[0].innerHTML = foodPrice*quantity;
            updateTotalPrice();
        }
        function change(foodId,foodPrice)
        {
            quantityElement = document.getElementById(foodId).getElementsByClassName("quantity")[0];
            if (quantityElement.value <= 0) quantityElement.value = 1;
            $.post('@Url.Action("change","Cart")',{foodId:foodId, quantity:quantityElement.value });
            document.getElementById(foodId).getElementsByClassName("price")[0].innerHTML = foodPrice*quantityElement.value;
            updateTotalPrice();
        }
        function remove(foodId,foodPrice)
        {
            $.post('@Url.Action("remove","Cart")',{foodId:foodId });
            document.getElementById(foodId).remove();
            updateTotalPrice();
        }
        function updateTotalPrice()
        {
            prices = document.getElementsByClassName("price");
            var totalprice = 0;
            for (var i=0; i < prices.length; i++)
            {
                totalprice += Number(prices[i].innerHTML);
            }
            document.getElementById("totalPrice").innerHTML=totalprice + " VND";
        }
    </script>
}